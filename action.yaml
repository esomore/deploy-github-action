name: 'build and push to dockerhub and initiate deploment'
description: 'Build docker image, push it to dockerhub and initiate deployment'
inputs:
  image-name:
    description: 'The docker container image name'
    required: true
  docker-file:
    description: 'The dockerfile used by the docker build command'
    required: true
  deploy-action-repo:
    description: 'Deployment will be invoked on this repo after image push'
    required: true
  dockerhub-username:
    description: 'Dockerhub username'
    required: true
  dockerhub-password:
    description: 'Dockerhub password'
    required: true
  github-pat:
    description: 'Github personal access token to be used to call the deploy-action-repo'
    required: true
  npm-registry:
    description: 'NPM registry url'
    required: false
  npm-user:
    description: 'NPM registry username'
    required: false
  npm-pass:
    description: 'NPM registry pasword'
    required: false
  npm-email:
    description: 'NPM users email address'
    required: false
  github-ref: 
    descripiton: 'branch ref'
    required: true
  github-sha:
    required: true
  
runs:
  using: 'docker'
  image: 'Dockerfile'
  env:
    IMAGE_NAME: ${{ inputs.image-name }}
    DOCKER_FILE: ${{ inputs.docker-file }}
    DOCKER_USERNAME: ${{ inputs.dockerhub-username }}
    DOCKER_PASSWORD: ${{ inputs.dockerhub-password }}
    GITHUB_PAT: ${{ inputs.github-pat }}
    NPM_REGISTRY: ${{ inputs.npm-registry }}
    NPM_USER: ${{ inputs.npm-user }}
    NPM_PASS: ${{ inputs.npm-pass }}
    NPM_EMAIL: ${{ inputs.npm-email }}
    DEPLOY_ACTION_REPO: ${{ inputs.deploy-action-repo }}
    GITHUB_REFL: ${{ imputs.github-ref }}
    GITHUB_SHA: ${{ inputs.github-sha }}
